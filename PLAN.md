# План реализации тренажёра слепой печати на Svelte

## Архитектура проекта

Проект будет использовать Svelte с Vite для сборки. Структура:

- `src/lib/` - основные модули и утилиты
- `src/components/` - компоненты Svelte
- `src/stores/` - Svelte stores для управления состоянием
- `src/data/` - словари и данные

## Этапы реализации

### 1. Инициализация проекта ✓

- Создать проект Svelte с Vite
- Настроить базовую структуру папок
- Добавить необходимые зависимости

### 2. Модель данных для клавиатур ✓

**Файл: `src/lib/keyboard.ts`**

- Определить интерфейсы для символов, рук, языков
- Создать конфигурации для английской (QWERTY) и русской (ЙЦУКЕН) раскладок:
  - Полный список допустимых символов (буквы, цифры, знаки препинания, версии с Shift)
  - Базовые клавиши для левой/правой руки
  - Привязка каждого символа к левой/правой руке
- Функции для валидации символов и определения принадлежности к руке

### 3. Словари для режима Phrases ✓

**Файл: `src/data/dictionaries.ts`**

- Массив английских слов
- Массив русских слов
- Функции для получения случайных слов

### 4. Управление состоянием приложения ✓

**Файл: `src/stores/app.ts`**

- Svelte store для глобального состояния:
  - Режим (настройка/арена)
  - Выбранный язык (English/Russian)
  - Тип тренировки (Select Keys/Random Key/Phrases/Files)
  - Специфические настройки для каждого режима

### 5. Управление файлами и прогрессом ✓

**Файл: `src/lib/fileManager.ts`**

- Функции для чтения файлов
- Обработка текста (фильтрация символов, нормализация пробелов)
- Хеширование содержимого файлов
- Работа с localStorage:
  - Сохранение/загрузка списка файлов
  - Сохранение/загрузка прогресса (current, count)
  - Сохранение/загрузка очищенных строк

### 6. Генераторы целей для тренировок ✓

**Файл: `src/lib/trainingGenerators.ts`**

- `SelectKeysGenerator` - генерация из пользовательского списка
- `RandomKeyGenerator` - случайная генерация из всех символов
- `PhrasesGenerator` - генерация фраз из словарей
- `FilesGenerator` - генерация из загруженных файлов
- Общий интерфейс: возврат пары `[current, followUp]`

### 7. Компонент режима настройки ✓

**Файл: `src/components/Settings.svelte`**

- Выбор языка (радио-кнопки или select)
- Выбор типа тренировки (радио-кнопки)
- Условный рендеринг специфических настроек:
  - **Select Keys**: поле ввода с обработкой клавиш, отображение списка выбранных символов
  - **Files**: загрузка файла, список загруженных файлов с прогрессом, кнопки удаления
- Кнопка `Start` (активна при выполнении условий)

### 8. Компонент режима арены

**Файл: `src/components/Arena.svelte`**

- Обработчики событий `keypress` и `keydown` на уровне документа
- Управление буфером ввода (`entered`)
- Сравнение с целевой строкой (`target`)
- Автоматическая загрузка следующей цели при совпадении
- Отображение:
  - Верхняя строка: `target`
  - Нижняя строка: `entered` с заменой whitespace на `·`, красная подсветка с первой ошибки
  - Адаптивный размер шрифта для длинных строк
- Обработка клика по телу страницы для возврата в режим настройки

### 9. Главный компонент приложения

**Файл: `src/App.svelte`**

- Управление переключением между режимами настройки и арены
- Инициализация состояния из localStorage при загрузке
- Обработка клика по телу страницы для возврата в настройки

### 10. Стилизация

**Файл: `src/app.css` или компоненты**

- Современный и чистый дизайн
- Адаптивная вёрстка
- Стили для режима арены (моноширинный шрифт, центрирование)
- Стили для ошибок (красная подсветка)
- Стили для режима настройки

### 11. Утилиты

**Файл: `src/lib/utils.ts`**

- Функция для замены whitespace на `·`
- Функция для вычисления хеша файла
- Вспомогательные функции для работы со строками

### 12. Главная точка входа

**Файл: `src/main.js`**

- Инициализация Svelte приложения
- Подключение глобальных стилей

## Детали реализации

### Обработка клавиатуры

- Использовать `svelte:window` для глобальных обработчиков или `document.addEventListener`
- В режиме арены перехватывать все события клавиатуры
- В режиме настройки разрешать нормальную работу полей ввода

### Логика followUp

- При генерации цели проверять, есть ли у символа "домашняя" рука
- Если есть, выбирать случайную базовую клавишу этой руки как `followUp`
- Использовать `followUp` перед запросом новой цели

### Работа с файлами

- Использовать `FileReader` API для чтения файлов
- Применять фильтрацию символов на основе текущего языка
- Сохранять очищенные строки в localStorage для быстрого доступа
- Восстанавливать состояние при загрузке страницы

### Валидация и обработка ошибок

- Игнорирование недопустимых символов в режиме Select Keys
- Правильная обработка Backspace в разных режимах
- Обработка завершения файла (пустая строка)

## Файловая структура

```
finger/
├── src/
│   ├── lib/
│   │   ├── keyboard.ts
│   │   ├── fileManager.ts
│   │   ├── trainingGenerators.ts
│   │   └── utils.ts
│   ├── stores/
│   │   └── app.ts
│   ├── components/
│   │   ├── Settings.svelte
│   │   └── Arena.svelte
│   ├── data/
│   │   └── dictionaries.ts
│   ├── App.svelte
│   ├── main.js
│   └── app.css
├── index.html
├── package.json
├── vite.config.js
└── SPEC.md
```

## Технические детали

- **Svelte**: последняя версия (Svelte 5.43.8)
- **Vite**: для сборки и разработки (Vite 7.2.4)
- **localStorage**: для сохранения прогресса файлов
- **События клавиатуры**: `keypress` для символов, `keydown` для Backspace

## Список задач

1. ✓ Инициализировать проект Svelte с Vite, настроить структуру папок
2. ✓ Создать модуль keyboard.ts с конфигурациями для английской и русской раскладок
3. ✓ Создать словари для режима Phrases (английские и русские слова)
4. ✓ Создать Svelte store для управления глобальным состоянием приложения
5. ✓ Реализовать fileManager.ts для работы с файлами и localStorage
6. ✓ Создать генераторы целей для всех четырёх типов тренировок
7. ✓ Реализовать компонент Settings.svelte с настройками для всех режимов
8. Реализовать компонент Arena.svelte с логикой ввода и отображения
9. Создать главный компонент App.svelte с переключением режимов
10. Добавить стили для всех компонентов и режимов
11. Создать утилиты для работы со строками и хеширования
12. Протестировать все режимы тренировок и переходы между состояниями

