## Finger Typing Tutor — Functional Specification

### 1. Назначение
- Браузерный тренажёр слепой печати.
- Поддерживает две раскладки: английская (QWERTY) и русская (ЙЦУКЕН).
- Предоставляет настраиваемые режимы тренировок и фиксирует прогресс в упражнениях по файлам.

### 2. Глобальные состояния
- `Режим настройки`: отображаются элементы выбора языка, типа тренировки, специфических настроек и кнопка `Start`.
- `Режим арены`: отображается рабочее поле тренировок.
- Переходы:
  - По умолчанию активен режим настройки.
  - Нажатие `Start` (если активна) запускает тренировку и скрывает блоки настройки.
  - Любой клик по телу страницы возвращает приложение в режим настройки и сбрасывает текущую сессию.

### 3. Выбор языка
- Опции: `English`, `Russian`; начальное значение — `English`.
- При смене языка:
  - Обновляется набор допустимых клавиш и их привязка к рукам.
  - Сбрасывается список клавиш в режиме «Select Keys».
  - Меняется словарь в режиме «Phrases».
  - Определяется фильтрация символов для режима «Files».

### 4. Набор допустимых клавиш
- Для каждого языка определён упорядоченный список символов: буквы, цифры, знаки препинания и их версии с Shift.
- Есть набор базовых клавиш для левой и правой руки `asdf`/`jkl;` для EN, `фыва`/`олдж` для RU).
- Для всех всех символов, кроме базовых, задана принадлежность к левой или правой руке.
- Этот набор допустимых клавиш используется для:
  - валидации пользовательского ввода в настройках,
  - генерации целей в режимах «Select Keys» и «Random Key»,
  - фильтрации текста в режиме «Files».

### 5. Общая логика арены
- Ввод:
  - Глобальные обработчики событий `keypress` и `keydown`.
  - При вводе символа длиной 1 добавляется к буферу `entered`.
  - Backspace удаляет последний символ буфера.
- Проверка:
  - После любого изменения буфера он сравнивается с целевой строкой.
  - При полном совпадении автоматически загружается следующий набор символов.
- Отображение:
  - Верхняя строка: целевая последовательность (`target`).
  - Нижняя строка: введённая последовательность с заменой пробелов и других whitespace на точку (`·`); начиная с первой ошибки остаток подсвечивается красным. Если ничего не введено, показывается неразрывный пробел.
  - Для длинных строк (режим файлов) уменьшается шрифт и разрешается перенос.
- Источник целей возвращает пары `[current, followUp]`:
  - Если `followUp` не `null`, она используется как следующая цель без обращения к источнику.
  - Иначе запрашивается новая пара.

### 6. Типы тренировок

#### 6.1 Select Keys
- Настройка:
  - Пользователь нажимает желаемые клавиши; символы приводятся к нижнему регистру.
  - Недопустимые символы игнорируются.
  - Дубликаты не добавляются.
  - Backspace удаляет последний символ.
  - Смена языка очищает список.
  - Кнопка `Start` активна, если список не пуст.
- Генерация:
  - Случайный символ из пользовательского списка.
  - Если у символа есть «домашняя» рука, выбирается случайная базовая клавиша этой руки и возвращается в качестве `followUp`; иначе `followUp=null`.

#### 6.2 Random Key
- Настроек нет, кнопка `Start` активна.
- Генерация:
  - Случайный символ из полного списка допустимых клавиш текущего языка.
  - `followUp` вычисляется по тому же правилу, что и в «Select Keys».

#### 6.3 Phrases
- Настроек нет, кнопка `Start` активна.
- Данные:
  - Словарь английских слов (массив строк).
  - Словарь русских слов (массив строк).
- Генерация:
  - `word1`: случайное слово, капитализируется (первая буква заглавная).
  - `word2`: случайное слово без изменений.
  - `punctuation`: случайный символ из `.,?!:;-`.
  - Итоговая строка: `word1 + ' ' + word2 + punctuation`, `followUp=null`.

#### 6.4 Files
- Настройка:
  - Пользователь выбирает текстовый файл (кодировка UTF-8).
  - Файл читается полностью, затем:
    - Делится на строки.
    - Каждый символ заменяется на пробел, если он недопустим для текущего языка (сравнение по нижнему регистру).
    - Последовательности пробелов сокращаются до одного, строка обрезается по краям.
    - Пустые строки удаляются.
  - Файлы идентифицируются по хешу содержимого; дубликаты игнорируются.
  - Для каждого файла сохраняются: `id`, `name`, `current` (сколько строк пройдено), `count` (сколько строк всего).
  - Данные и очищенные строки сохраняются локально в localStorage и восстанавливаются при загрузке страницы.
  - Список файлов отображается как `name - current/count`; активный файл выделяется. Кнопка `del` удаляет запись и очищает выбор при необходимости.
  - кнопка `Start` активна только при выбранном файле.
- Генерация:
  - При входе в арену подгружается массив строк активного файла и позиция `current`.
  - Возвращается строка `lines[current]` и `followUp=null`.
  - После успешного ввода `current` увеличивается и сохраняется.
  - По достижении `current === count` возвращается пустая строка, что сигнализирует о завершении файла.

### 7. Дополнительные требования
- Все случайные выборки (символы, слова, знаки) равновероятны.
- Возврат в режим настройки сбрасывает временные данные текущей тренировки (например, буферы символов), но сохранённый прогресс файлов остаётся.
- Приложение не содержит других интерактивных элементов в режиме тренировки, чтобы фокус клавиатуры всегда оставался на документе.


